# 功能测试清单

## 测试环境确认

### 服务运行状态
- [ ] Swiss Ephemeris 服务运行在 http://localhost:3100
- [ ] Next.js 开发服务器运行在 http://localhost:3007
- [ ] Supabase 数据库已配置且可访问

### 环境变量检查
```bash
# 确认 .env.local 包含：
✓ NEXT_PUBLIC_SUPABASE_URL
✓ NEXT_PUBLIC_SUPABASE_ANON_KEY
✓ SUPABASE_SERVICE_ROLE_KEY (可选)
✓ GEMINI_API_KEY
```

## 测试流程

### 1. 首页重定向测试
1. [ ] 打开 http://localhost:3007
2. [ ] 验证自动跳转到 `/login` 页面
3. [ ] 检查页面显示正常（无报错）
4. [ ] 查看浏览器控制台（应该没有错误）

**预期结果**: 未登录用户自动跳转到登录页

---

### 2. 用户注册测试
1. [ ] 在登录页点击"注册"标签
2. [ ] 输入测试信息：
   - 昵称: 测试用户
   - 邮箱: test@example.com
   - 密码: test123456
3. [ ] 点击"注册"按钮
4. [ ] 查看提示信息

**预期结果**:
- 显示"注册成功！请检查您的邮箱以验证账户"
- （注意：Supabase 默认需要邮箱验证，测试环境可在 Supabase Dashboard 中关闭）

**如果需要跳过邮箱验证**:
1. 进入 Supabase Dashboard
2. Authentication > Settings
3. 关闭 "Enable email confirmations"

---

### 3. 用户登录测试
1. [ ] 在登录页输入账号密码
2. [ ] 点击"登录"按钮
3. [ ] 验证自动跳转到 `/calculate` 页面
4. [ ] 检查导航栏显示用户邮箱

**预期结果**:
- 成功登录并跳转到计算器
- 导航栏显示用户信息

---

### 4. 人类图计算测试（精确度验证）
使用标准测试数据：**刘勇**
- 姓名: 刘勇
- 出生日期: 1970-12-19
- 出生时间: 14:30
- 出生地点: 北京
- 时区: Asia/Shanghai

**操作步骤**:
1. [ ] 在计算器页面输入以上信息
2. [ ] 点击"计算人类图"
3. [ ] 等待计算完成（约1-3秒）

**预期结果**:
```
✓ 类型: Projector (投射者)
✓ 人生角色: 5/1
✓ 内在权威: Sounding Board (环境权威)
✓ 几分人: Split Definition (二分人)
✓ 轮回交叉: 左角度交叉之教育 Education (11/12 | 46/25)

星盘数据：
个性端 (黑色):
  ☉ 太阳: 30.1
  ⊕ 地球: 29.1
  ☊ 北交点: 30.1
  ☋ 南交点: 4.1

设计端 (红色):
  ☉ 太阳: 55.3
  ⊕ 地球: 59.3
  ☊ 北交点: 55.3
  ☋ 南交点: 25.3
```

**关键验证点**:
- [ ] 北交点个性: 30.1 (不是 30.2)
- [ ] 北交点设计: 55.3 (不是 55.2)
- [ ] 轮回交叉英文名有空格: "Education" (不是 "EDUCATION")
- [ ] 轮回交叉类型正确: "左角度交叉之教育"

---

### 5. 数据保存测试
1. [ ] 计算完成后，点击"保存数据"按钮
2. [ ] 查看提示信息
3. [ ] 检查页面底部"已保存的数据"列表

**预期结果**:
- 显示"保存成功！"
- 保存的数据列表中出现新记录
- 点击记录可以重新查看

**Supabase 验证**:
1. [ ] 打开 Supabase Dashboard
2. [ ] 进入 Table Editor > charts
3. [ ] 查看是否有新记录
4. [ ] 验证 chart_data 字段包含完整数据

---

### 6. 历史记录加载测试
1. [ ] 刷新页面
2. [ ] 等待页面加载
3. [ ] 检查"已保存的数据"列表

**预期结果**:
- 自动加载之前保存的记录
- 点击记录可以查看详情

---

### 7. 认证保护测试
1. [ ] 在浏览器中打开开发者工具
2. [ ] Application > Local Storage > Clear All
3. [ ] 刷新页面

**预期结果**:
- 清除登录状态后自动跳转到登录页
- 无法访问 `/calculate` 页面

---

### 8. 退出登录测试（如果已实现）
1. [ ] 点击导航栏的用户菜单或退出按钮
2. [ ] 验证跳转到登录页

**预期结果**:
- 成功退出
- 跳转到登录页
- 无法再访问受保护页面

---

## 已知问题和注意事项

### Supabase 邮箱验证
- **问题**: 默认开启邮箱验证，测试不便
- **解决**: 在 Supabase Dashboard 中关闭邮箱验证
  - Authentication > Settings
  - 取消勾选 "Enable email confirmations"

### 端口占用
- **问题**: 3000 端口被占用
- **当前**: 使用 3007 端口
- **影响**: 无影响，正常使用

### Swiss Ephemeris 服务
- **重要**: 必须先启动 `node server/swisseph-service.js`
- **验证**: 访问 http://localhost:3100/health
- **预期**: 返回 `{"status":"ok","swissephReady":true}`

---

## 性能测试

### 计算速度
- [ ] 首次计算响应时间 < 3秒
- [ ] 后续计算响应时间 < 2秒
- [ ] 保存数据响应时间 < 1秒

### 数据准确性
使用多个测试案例验证：

**测试案例 1: 刘勇**
- 出生: 1970-12-19 14:30 北京
- 预期: 30.1, 29.1, 55.3, 59.3

**测试案例 2: 陶子** (如果有数据)
- 验证类型、权威、定义是否正确

---

## 错误处理测试

### 1. 无效输入
- [ ] 不填写姓名
- [ ] 不填写日期/时间
- [ ] 选择未来日期

**预期**: 显示友好的错误提示

### 2. 网络错误
- [ ] 关闭 Swiss Ephemeris 服务
- [ ] 尝试计算

**预期**:
- 使用 Jean Meeus 公式作为后备
- 或显示"服务不可用"错误

### 3. Supabase 连接错误
- [ ] 使用错误的 Supabase 凭证
- [ ] 尝试保存数据

**预期**: 显示"保存失败"错误信息

---

## 浏览器兼容性测试

- [ ] Chrome/Edge (推荐)
- [ ] Firefox
- [ ] Safari
- [ ] 移动浏览器

---

## 测试完成标准

全部测试通过后，应用可以投入使用：

1. ✅ 用户可以注册/登录
2. ✅ 计算结果 100% 准确
3. ✅ 数据可以保存到 Supabase
4. ✅ 历史记录可以正常加载
5. ✅ 认证保护正常工作
6. ✅ 错误处理友好

---

**测试日期**: ___________
**测试人**: ___________
**测试结果**: [ ] 通过 / [ ] 未通过
**备注**: ___________
