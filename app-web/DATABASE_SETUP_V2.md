# äººç±»å›¾ AI é™ªä¼´å¹³å° - æ•°æ®åº“è®¾ç½®æŒ‡å— V2

## ğŸ“‹ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### ç”¨æˆ·å·¥ä½œæµç¨‹ï¼š
1. ç”¨æˆ·ä¸Šä¼ äººç±»å›¾å›¾ç‰‡
2. æ‰‹åŠ¨å½•å…¥æˆ– AI è¯†åˆ«äººç±»å›¾å…³é”®ä¿¡æ¯
3. ç³»ç»Ÿå­˜å‚¨ç»“æ„åŒ–æ•°æ®
4. ç”¨æˆ·å¯éšæ—¶æŸ¥çœ‹å›¾ç‰‡å’Œæ•°æ®
5. AI åŸºäºæ•°æ®æä¾›è§£è¯»å’Œé™ªä¼´

---

## ğŸ–¼ï¸ Supabase Storage é…ç½®

### å…è´¹é¢åº¦è¯´æ˜ï¼š
- âœ… **1 GB å­˜å‚¨ç©ºé—´**
- âœ… **2 GB å¸¦å®½/æœˆ**
- âœ… å•å¼ äººç±»å›¾çº¦ **200-500 KB**
- âœ… ç†è®ºä¸Šå¯å­˜å‚¨ **2000-5000 å¼ å›¾ç‰‡**

### åˆ›å»ºå­˜å‚¨æ¡¶æ­¥éª¤ï¼š

1. **ç™»å½• Supabase Dashboard**
2. **è¿›å…¥ Storage ç®¡ç†**ï¼š
   - ç‚¹å‡»å·¦ä¾§èœå• **"Storage"**
   - ç‚¹å‡» **"Create a new bucket"**

3. **åˆ›å»º chart-images å­˜å‚¨æ¡¶**ï¼š
   ```
   Bucket name: chart-images
   Public bucket: âŒ å…³é—­ (ç§æœ‰å­˜å‚¨ï¼Œåªæœ‰ç”¨æˆ·è‡ªå·±èƒ½è®¿é—®)
   File size limit: 5 MB (å•ä¸ªæ–‡ä»¶æœ€å¤§ 5MB)
   Allowed MIME types: image/jpeg, image/png, image/jpg
   ```

4. **é…ç½®å­˜å‚¨æ¡¶ç­–ç•¥**ï¼š
   - åœ¨ Storage é¡µé¢ï¼Œé€‰æ‹© `chart-images` å­˜å‚¨æ¡¶
   - ç‚¹å‡» **"Policies"**
   - ç‚¹å‡» **"New Policy"**
   - æ·»åŠ ä»¥ä¸‹ç­–ç•¥ï¼ˆè§ä¸‹æ–¹ SQLï¼‰

### å­˜å‚¨æ¡¶ç­–ç•¥ SQLï¼š

```sql
-- 1. å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå·±çš„äººç±»å›¾å›¾ç‰‡
CREATE POLICY "Users can upload own chart images"
ON storage.objects FOR INSERT
WITH CHECK (
  bucket_id = 'chart-images' AND
  auth.uid()::text = (storage.foldername(name))[1]
);

-- 2. å…è®¸ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„äººç±»å›¾å›¾ç‰‡
CREATE POLICY "Users can view own chart images"
ON storage.objects FOR SELECT
USING (
  bucket_id = 'chart-images' AND
  auth.uid()::text = (storage.foldername(name))[1]
);

-- 3. å…è®¸ç”¨æˆ·åˆ é™¤è‡ªå·±çš„äººç±»å›¾å›¾ç‰‡
CREATE POLICY "Users can delete own chart images"
ON storage.objects FOR DELETE
USING (
  bucket_id = 'chart-images' AND
  auth.uid()::text = (storage.foldername(name))[1]
);
```

### æ–‡ä»¶å­˜å‚¨ç»“æ„ï¼š
```
chart-images/
  â”œâ”€â”€ {user_id}/
  â”‚   â”œâ”€â”€ chart_1.jpg
  â”‚   â”œâ”€â”€ chart_2.png
  â”‚   â””â”€â”€ chart_3.jpg
  â””â”€â”€ {another_user_id}/
      â””â”€â”€ chart_1.jpg
```

---

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„è¯¦è§£

### `charts` è¡¨ - äººç±»å›¾æ•°æ®

è¿™æ˜¯æ ¸å¿ƒè¡¨ï¼Œå­˜å‚¨æ‰€æœ‰äººç±»å›¾ä¿¡æ¯ï¼š

```sql
-- åŸºæœ¬ä¿¡æ¯
chart_name              TEXT        -- äººç±»å›¾åç§°ï¼ˆå§“åæˆ–å¤‡æ³¨ï¼‰
chart_image_url         TEXT        -- å›¾ç‰‡ URL

-- æ ¸å¿ƒå±æ€§
profile                 TEXT        -- äººç”Ÿè§’è‰²: 3/5, 1/3
incarnation_cross_name  TEXT        -- è½®å›äº¤å‰: å³è§’åº¦äº¤å‰ä¹‹ç´§å¼ 
type                    TEXT        -- ç±»å‹: æ˜¾ç¤ºè€…/ç”Ÿäº§è€…/...
authority               TEXT        -- å†…åœ¨æƒå¨: æƒ…ç»ªæƒå¨/èéª¨æƒå¨/...
definition_type         TEXT        -- å‡ åˆ†äºº: 1åˆ†äºº/2åˆ†äºº/...

-- å››ä¸ªäº¤ç‚¹
design_south_node       TEXT        -- è®¾è®¡å—äº¤ç‚¹ (çº¢è‰²): "11.3"
design_north_node       TEXT        -- è®¾è®¡åŒ—äº¤ç‚¹ (çº¢è‰²): "12.3"
personality_south_node  TEXT        -- äººæ ¼å—äº¤ç‚¹ (é»‘è‰²): "11.3"
personality_north_node  TEXT        -- äººæ ¼åŒ—äº¤ç‚¹ (é»‘è‰²): "12.3"

-- é€šé“åˆ—è¡¨ (JSON)
channels                JSONB       -- ["1-8", "7-31", "10-20"]

-- è¡Œæ˜Ÿé—¸é—¨æ•°æ® (JSON)
planetary_gates         JSONB       -- è§ä¸‹æ–¹ç¤ºä¾‹
```

### `planetary_gates` å­—æ®µæ ¼å¼ç¤ºä¾‹ï¼š

```json
{
  "sun": {
    "design": "23.4",
    "personality": "43.2"
  },
  "earth": {
    "design": "43.4",
    "personality": "23.2"
  },
  "moon": {
    "design": "5.2",
    "personality": "35.1"
  },
  "north_node": {
    "design": "11.3",
    "personality": "11.3"
  },
  "south_node": {
    "design": "12.3",
    "personality": "12.3"
  },
  "mercury": {
    "design": "17.5",
    "personality": "62.3"
  },
  "venus": {
    "design": "31.2",
    "personality": "7.4"
  },
  "mars": {
    "design": "34.1",
    "personality": "20.5"
  },
  "jupiter": {
    "design": "46.6",
    "personality": "29.3"
  },
  "saturn": {
    "design": "54.2",
    "personality": "32.1"
  },
  "uranus": {
    "design": "18.4",
    "personality": "58.2"
  },
  "neptune": {
    "design": "38.3",
    "personality": "28.5"
  },
  "pluto": {
    "design": "41.1",
    "personality": "30.4"
  }
}
```

---

## ğŸ“¥ æ•°æ®å½•å…¥ç¤ºä¾‹

### ç¤ºä¾‹ 1: å®Œæ•´çš„äººç±»å›¾æ•°æ®

```sql
INSERT INTO charts (
  user_id,
  chart_name,
  chart_image_url,
  profile,
  incarnation_cross_name,
  incarnation_cross_english,
  type,
  type_english,
  authority,
  authority_english,
  definition_type,
  design_south_node,
  design_north_node,
  personality_south_node,
  personality_north_node,
  channels,
  planetary_gates
) VALUES (
  'user-uuid-here',
  'å¼ ä¸‰çš„äººç±»å›¾',
  'https://xxx.supabase.co/storage/v1/object/public/chart-images/user-id/chart1.jpg',
  '3/5',
  'å³è§’åº¦äº¤å‰ä¹‹ç´§å¼ ',
  'Right Angle Cross of Tension',
  'æ˜¾ç¤ºç”Ÿäº§è€…',
  'Manifesting Generator',
  'èéª¨æƒå¨',
  'Sacral Authority',
  '1åˆ†äºº',
  '11.3',
  '12.3',
  '11.3',
  '12.3',
  '["1-8", "7-31", "10-20", "13-33"]'::jsonb,
  '{
    "sun": {"design": "23.4", "personality": "43.2"},
    "earth": {"design": "43.4", "personality": "23.2"}
  }'::jsonb
);
```

---

## ğŸ¯ å‰ç«¯å±•ç¤º - è¡¨æ ¼å½¢å¼

æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæ•°æ®å°†ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºï¼š

### åŸºæœ¬ä¿¡æ¯è¡¨ï¼š
| é¡¹ç›® | å€¼ |
|------|-----|
| å§“å | å¼ ä¸‰ |
| äººç”Ÿè§’è‰² | 3/5 |
| è½®å›äº¤å‰ | å³è§’åº¦äº¤å‰ä¹‹ç´§å¼  |
| ç±»å‹ | æ˜¾ç¤ºç”Ÿäº§è€… |
| å†…åœ¨æƒå¨ | èéª¨æƒå¨ |
| å‡ åˆ†äºº | 1åˆ†äºº |

### äº¤ç‚¹ä¿¡æ¯è¡¨ï¼š
| äº¤ç‚¹ç±»å‹ | é—¸é—¨.çˆ»çº¿ |
|---------|----------|
| è®¾è®¡å—äº¤ç‚¹ (çº¢è‰²) | 11.3 |
| è®¾è®¡åŒ—äº¤ç‚¹ (çº¢è‰²) | 12.3 |
| äººæ ¼å—äº¤ç‚¹ (é»‘è‰²) | 11.3 |
| äººæ ¼åŒ—äº¤ç‚¹ (é»‘è‰²) | 12.3 |

### é€šé“åˆ—è¡¨è¡¨ï¼š
| åºå· | é€šé“ | ä¸­æ–‡åç§° | è‹±æ–‡åç§° |
|------|------|---------|---------|
| 1 | 1-8 | å¯å‘çš„é€šé“ | Channel of Inspiration |
| 2 | 7-31 | åˆ›å§‹è€…çš„é€šé“ | Channel of the Alpha |
| 3 | 10-20 | è§‰é†’çš„é€šé“ | Channel of Awakening |

### è¡Œæ˜Ÿé—¸é—¨è¡¨ï¼š
| è¡Œæ˜Ÿ | è®¾è®¡é—¸é—¨ (çº¢è‰²) | äººæ ¼é—¸é—¨ (é»‘è‰²) |
|------|----------------|----------------|
| å¤ªé˜³ (Sun) | 23.4 | 43.2 |
| åœ°çƒ (Earth) | 43.4 | 23.2 |
| æœˆäº® (Moon) | 5.2 | 35.1 |
| æ°´æ˜Ÿ (Mercury) | 17.5 | 62.3 |
| é‡‘æ˜Ÿ (Venus) | 31.2 | 7.4 |
| ç«æ˜Ÿ (Mars) | 34.1 | 20.5 |
| æœ¨æ˜Ÿ (Jupiter) | 46.6 | 29.3 |
| åœŸæ˜Ÿ (Saturn) | 54.2 | 32.1 |
| å¤©ç‹æ˜Ÿ (Uranus) | 18.4 | 58.2 |
| æµ·ç‹æ˜Ÿ (Neptune) | 38.3 | 28.5 |
| å†¥ç‹æ˜Ÿ (Pluto) | 41.1 | 30.4 |
| åŒ—äº¤ç‚¹ (North Node) | 11.3 | 11.3 |
| å—äº¤ç‚¹ (South Node) | 12.3 | 12.3 |

---

## ğŸš€ æ‰§è¡Œæ­¥éª¤

### ç¬¬ä¸€æ­¥: åˆ›å»ºå­˜å‚¨æ¡¶
1. Supabase Dashboard â†’ Storage
2. Create bucket: `chart-images`
3. è®¾ç½®ä¸ºç§æœ‰å­˜å‚¨æ¡¶

### ç¬¬äºŒæ­¥: æ‰§è¡Œæ•°æ®åº“ SQL
1. Supabase Dashboard â†’ SQL Editor
2. å¤åˆ¶ `supabase-schema-v2.sql` å†…å®¹
3. ç‚¹å‡» Run æ‰§è¡Œ

### ç¬¬ä¸‰æ­¥: é…ç½®å­˜å‚¨æ¡¶ç­–ç•¥
1. Storage â†’ chart-images â†’ Policies
2. æ·»åŠ ä¸Šä¼ ã€æŸ¥çœ‹ã€åˆ é™¤ç­–ç•¥

### ç¬¬å››æ­¥: å¯¼å…¥é™æ€æ•°æ®
- å¯¼å…¥ 192 æ¡è½®å›äº¤å‰æ•°æ®
- å¯¼å…¥ 36 æ¡é€šé“æ•°æ®
- å¯¼å…¥ 64 ä¸ªé—¸é—¨æ•°æ®
- å¯¼å…¥ 9 ä¸ªèƒ½é‡ä¸­å¿ƒæ•°æ®

---

## ğŸ“¸ å…³äºå›¾ç‰‡åŠŸèƒ½çš„æ€»ç»“

### âœ… æ¨èä½¿ç”¨å›¾ç‰‡å­˜å‚¨ï¼š
- ç”¨æˆ·å¯ä»¥éšæ—¶æŸ¥çœ‹åŸå§‹äººç±»å›¾
- æ–¹ä¾¿æ ¸å¯¹æ•°æ®å‡†ç¡®æ€§
- å¢å¼ºç”¨æˆ·ä½“éªŒ
- 1GB ç©ºé—´è¶³å¤Ÿ 2000+ å¼ å›¾ç‰‡

### ğŸ“‚ æ–‡ä»¶å‘½åè§„èŒƒï¼š
```
{user_id}/{timestamp}_{chart_name}.jpg

ç¤ºä¾‹:
550e8400-e29b-41d4-a716-446655440000/1641234567_å¼ ä¸‰.jpg
```

### ğŸ”’ å®‰å…¨ä¿è¯ï¼š
- âœ… æ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„å›¾ç‰‡
- âœ… å›¾ç‰‡ URL éœ€è¦è®¤è¯æ‰èƒ½è®¿é—®
- âœ… RLS ç­–ç•¥è‡ªåŠ¨ä¿æŠ¤æ•°æ®å®‰å…¨

---

## ğŸ¨ å…³äºåŠ¨æ€ç»˜å›¾åŠŸèƒ½

### ç°é˜¶æ®µ (V1):
- âœ… ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
- âœ… æ‰‹åŠ¨å½•å…¥æ•°æ®
- âœ… è¡¨æ ¼å±•ç¤ºä¿¡æ¯

### æœªæ¥ä¼˜åŒ– (V2):
- ğŸ”„ å¼€å‘ SVG åŠ¨æ€ç»˜å›¾åŠŸèƒ½
- ğŸ”„ åŸºäºæ•°æ®å®æ—¶ç”Ÿæˆäººç±»å›¾
- ğŸ”„ æ”¯æŒè‡ªå®šä¹‰æ ·å¼å’Œé¢œè‰²
- ğŸ”„ å¯ä»¥å¯¼å‡ºä¸ºå›¾ç‰‡

**æŠ€æœ¯å¯è¡Œæ€§**: âœ… å®Œå…¨å¯è¡Œï¼Œä½¿ç”¨ Canvas/SVG + åº•å›¾å åŠ 

---

## â“ å¸¸è§é—®é¢˜

### Q1: å›¾ç‰‡å­˜å‚¨ä¼šå¾ˆå¿«ç”¨å®Œå—ï¼Ÿ
**A**: ä¸ä¼šã€‚å‡è®¾æ¯å¼ å›¾ç‰‡ 300KBï¼Œ1GB å¯å­˜å‚¨ 3400+ å¼ å›¾ç‰‡ã€‚

### Q2: å¦‚æœè¶…å‡ºå…è´¹é¢åº¦æ€ä¹ˆåŠï¼Ÿ
**A**: Supabase æä¾›ä»˜è´¹å‡çº§ï¼š
- Pro Plan: 8$/æœˆï¼ŒåŒ…å« 100GB å­˜å‚¨
- æˆ–è€…ä½¿ç”¨å…¶ä»–å›¾åºŠæœåŠ¡ï¼ˆå¦‚é˜¿é‡Œäº‘ OSSï¼‰

### Q3: æ•°æ®å½•å…¥ä¼šå¾ˆéº»çƒ¦å—ï¼Ÿ
**A**: å°†æ¥å¯ä»¥å¼€å‘ï¼š
- OCR è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ä¸­çš„æ•°å­—
- AI è¾…åŠ©å½•å…¥
- æ‰¹é‡å¯¼å…¥åŠŸèƒ½

### Q4: èƒ½å¦å®ç°å›¾ç‰‡è‡ªåŠ¨ç”Ÿæˆï¼Ÿ
**A**: å¯ä»¥ï¼æŠ€æœ¯æ–¹æ¡ˆï¼š
- ä½¿ç”¨åº•å›¾ + SVG å åŠ 
- æ ¹æ®é€šé“æ•°æ®ç»˜åˆ¶è¿æ¥çº¿
- æ ¹æ®ä¸­å¿ƒæ•°æ®å¡«å……é¢œè‰²
- é¢„è®¡å¼€å‘æ—¶é—´ 2-3 å‘¨

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… åœ¨ Supabase åˆ›å»ºå­˜å‚¨æ¡¶
2. âœ… æ‰§è¡Œ `supabase-schema-v2.sql`
3. âœ… é…ç½®å­˜å‚¨æ¡¶ç­–ç•¥
4. â³ å¼€å‘ä¸Šä¼ å›¾ç‰‡åŠŸèƒ½
5. â³ å¼€å‘æ•°æ®å½•å…¥è¡¨å•
6. â³ å¼€å‘è¡¨æ ¼å±•ç¤ºé¡µé¢
7. â³ é›†æˆ AI é™ªä¼´åŠŸèƒ½
