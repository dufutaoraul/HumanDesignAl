# 人类图 AI 陪伴平台 - 需求文档 V2.0

## 一、项目概述

**项目名称**：人类图 AI 高我陪伴平台
**核心定位**：基于人类图的 AI 智能陪伴和命理资料库系统
**技术栈**：Next.js 15 + TypeScript + Supabase + Google Gemini API + hdkit

---

## 二、核心功能模块

### 2.1 与高我对话（首页核心功能）

**界面设计**：
- 黑色/深色背景（神秘、专业、唯美夜空风格）
- 中央为AI对话界面
- 简洁、专注的交互体验

**功能特性**：
- 用户与AI对话，探讨人类图相关问题
- AI基于用户的人类图数据提供个性化解读
- 实时对话流式响应
- 支持上下文记忆

---

### 2.2 人类图资料库（核心模块）

#### 2.2.1 数据录入方式（新方案 - 计算生成）

**用户输入**：
- 出生日期（年月日时分）
- 出生地点（城市/经纬度）
- 姓名/昵称

**系统处理**：
1. 调用 **hdkit** 或类似开源库计算26个行星闸门数据：
   - 太阳、月亮、水星、金星、火星、木星、土星、天王星、海王星、冥王星、地球、南交点、北交点
   - 每个行星的人格（黑色/意识）和设计（红色/潜意识）闸门
2. 根据行星闸门自动计算：
   - 9个能量中心的激活状态
   - 36条通道的激活情况
   - 人类图类型（显示者/生产者/投射者/反映者/显示生产者）
   - 人生角色（Profile）
   - 权威（Authority）
   - 轮回交叉（Incarnation Cross）

**数据存储**：
- 所有计算结果存入 Supabase 数据库
- 关联用户账号
- 支持多个人类图记录（自己、家人、朋友）

#### 2.2.2 人类图可视化（出图功能）

**图表生成**：
- 使用 SVG/Canvas 绘制标准人类图（Bodygraph）
- 参考开源项目 **hdkit** 的绘图方案
- 优化视觉效果，设计更美观的图表样式

**显示内容**：
- 9个能量中心（三角形、方形、菱形）
- 36条通道（连接线，激活用彩色高亮）
- 64个闸门（数字标注）
- 行星闸门数据（左右两列，Design红色 + Personality黑色）
- 类型、权威、人生角色、轮回交叉等关键信息

**交互功能**：
- 可点击查看详细解释
- 导出图片功能
- 打印功能

#### 2.2.3 资料管理

- 查看所有已保存的人类图
- 编辑/删除
- 搜索/筛选
- 标签分类（自己/家人/朋友/明星等）

---

### 2.3 用户认证系统

**登录/注册**：
- 参考 Seth 项目的认证实现
- 使用 Supabase Auth
- 支持邮箱注册
- 可选：第三方登录（微信/Google）

**权限管理**：
- 游客：只能使用AI对话（无数据存储）
- 注册用户：完整功能访问

---

### 2.4 顶部导航栏

**模块入口**：
- 🏠 首页（与高我对话）
- 📊 人类图资料库
- 👤 个人中心
- 🚪 登录/注册

**未来扩展**（暂不实现）：
- 生命数字资料库
- 占星资料库
- 八字资料库

---

## 三、技术实现方案

### 3.1 人类图计算引擎

**选型对比**：

| 项目 | 语言 | 优点 | 缺点 | 选择 |
|------|------|------|------|------|
| **hdkit** | JavaScript | 有React/Node示例，支持SVG绘图，MIT开源 | 2016年项目，更新较少 | ✅ **推荐** |
| **humandesign_frontend_js** | JavaScript | 使用Vue + PaperJS绘图 | 依赖Python后端，2017年停更 | ❌ |
| **SharpAstrology.HumanDesign** | C# | 精确计算，活跃维护 | 需要.NET环境，集成复杂 | ❌ |

**实施方案**：
1. 研究 **hdkit** 的源代码
2. 提取核心计算逻辑（行星位置 → 闸门 → 通道 → 类型）
3. 集成到 Next.js API Route
4. 或使用 npm 包直接调用

### 3.2 SVG 绘图方案

**参考资源**：
- hdkit 的 SVG Rave Mandala 生成示例
- 参考用户提供的名人人类图样式
- 优化配色和排版

**绘图库选择**：
- 方案1：纯 SVG（推荐）
- 方案2：Canvas
- 方案3：D3.js

### 3.3 数据库设计

**Supabase 表结构**：

```sql
-- 用户表（使用 Supabase Auth 自带）
auth.users

-- 人类图记录表
human_design_charts
- id (uuid, primary key)
- user_id (uuid, foreign key → auth.users)
- name (text) -- 姓名/昵称
- birth_date (timestamp with time zone)
- birth_location (jsonb) -- {city, lat, lng}
- chart_data (jsonb) -- 完整的人类图数据
- created_at (timestamp)
- updated_at (timestamp)

-- AI 对话历史表
chat_messages
- id (uuid, primary key)
- user_id (uuid, foreign key → auth.users)
- chart_id (uuid, foreign key → human_design_charts, nullable)
- role (text) -- 'user' | 'assistant'
- content (text)
- created_at (timestamp)
```

---

## 四、开发优先级

### Phase 1：核心计算和存储（2周）
1. ✅ 研究 hdkit 项目并集成
2. ✅ 实现出生信息输入表单
3. ✅ 实现行星闸门计算逻辑
4. ✅ 设计并创建 Supabase 数据库表
5. ✅ 实现数据保存功能
6. ✅ 实现用户认证（参考Seth项目）

### Phase 2：可视化和界面（2周）
1. ✅ 实现人类图 SVG 绘制
2. ✅ 优化图表美观度
3. ✅ 重新设计首页（黑色AI对话界面）
4. ✅ 实现顶部导航栏
5. ✅ 实现资料库列表页面

### Phase 3：AI 对话功能（1周）
1. ✅ 集成 Gemini API 做对话
2. ✅ 实现基于用户人类图的个性化解读
3. ✅ 实现对话历史存储
4. ✅ 优化对话体验

### Phase 4：完善和优化（1周）
1. ✅ 添加图片导出功能
2. ✅ 移动端适配
3. ✅ 性能优化
4. ✅ 测试和修复bug

---

## 五、放弃的旧功能

❌ **图片上传识别功能**：
- **原因**：Gemini API 识别速度太慢（25-60秒），用户体验差
- **替代方案**：直接通过出生信息计算生成，秒级响应

❌ **手动编辑26个行星闸门**：
- **原因**：改为自动计算，无需用户手动输入
- **保留**：可能保留微调功能，允许用户修正计算结果

---

## 六、UI/UX 设计原则

### 6.1 色彩方案
- **主色调**：深色背景（#0a0a1a ~ #1a1a2e）
- **强调色**：紫色/金色渐变（神秘、高贵）
- **功能色**：
  - 人格（Personality）：黑色 (#000000)
  - 设计（Design）：红色 (#e74c3c)
  - 激活通道：彩色高亮
  - 未激活：灰色

### 6.2 交互体验
- 简洁、直观
- 流畅的动画过渡
- 移动端优先
- 快速响应（<2秒生成图表）

---

## 七、开源项目参考

### 7.1 hdkit
- **GitHub**: https://github.com/jdempcy/hdkit
- **用途**: 人类图计算引擎 + SVG绘图
- **许可**: MIT

### 7.2 Seth 项目
- **路径**: `D:\CursorWork\Seth`
- **用途**: 参考认证系统和数据库设计

---

## 八、项目里程碑

- **MVP 版本** (4周)：出生信息输入 → 计算 → 绘图 → 存储
- **Beta 版本** (6周)：+ AI对话功能
- **正式版本** (8周)：+ 完善的资料管理和用户系统

---

## 九、风险和挑战

1. **天文计算精度**：需要确保行星位置计算的准确性
2. **绘图复杂度**：人类图有64个闸门、36条通道，绘制复杂
3. **AI 解读质量**：需要大量人类图知识的 prompt 工程
4. **用户隐私**：出生信息属于敏感数据，需要加密存储

---

## 十、未来扩展方向

1. **多种命理系统整合**：生命数字、占星、八字
2. **付费解读服务**：深度报告、一对一咨询
3. **社区功能**：用户分享、讨论
4. **移动应用**：iOS/Android App
5. **国际化**：多语言支持

---

**文档版本**: V2.0
**更新日期**: 2025-10-10
**维护者**: Claude + 用户
